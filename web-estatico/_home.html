<div id="map">
    <form id="buscaRapida">
        <div class="form-header">
            <select class="form-header-alt-select" id="tiposAquisicao" name="tiposAquisicao">
                <option value="0">Comprar</option>
                <option value="1">Alugar</option>
                <option value="2">Temporada</option>
            </select>
            <select id="tiposResidencia" name="tiposResidencia"></select>
            <select id="estados" name="estados"></select>
            <select id="cidades" name="cidades"></select>
            <button alt="Buscar" id="buscar" title="Buscar" type="submit">
                Buscar</button>
        </div>
    </form>
</div>
<div class="flexslider">
    <ul class="slides">
        <li>
            <img src="img/slide1.jpg" />
            <span>APARTAMENTO</span>
            <h3>Cambuí</h3>
            <p>
                Condomínio fechado, com piscina, academia e churrasqueira a 10 minutos do centro...
            </p>
        </li>
        <li>
            <img src="img/slide2.jpg" />
            <span>APARTAMENTO</span>
            <h3>Centro</h3>
            <p>
                Condomínio fechado, com piscina, academia e churrasqueira a 10 minutos do centro...
            </p>
        </li>
        <li>
            <img src="img/slide3.jpg" />
            <span>APARTAMENTO</span>
            <h3>Novo Cambuí</h3>
            <p>
                Condomínio fechado, com piscina, academia e churrasqueira a 10 minutos do centro...
            </p>
        </li>
        <li>
            <img src="img/slide4.jpg" />
            <span>CASA</span>
            <h3>Alphavile</h3>
            <p>
                Condomínio fechado, com piscina, academia e churrasqueira a 10 minutos do centro...
            </p>
        </li>
        <li>
            <img src="img/slide5.jpg" />
            <span>CASA</span>
            <h3>Valinhos</h3>
            <p>
                Condomínio fechado, com piscina, academia e churrasqueira a 10 minutos do centro...
            </p>
        </li>
    </ul>
</div>
<script type="text/javascript" charset="utf-8">
    /* Inicio - Grupo de comandos de carga de plugins */
    // OpenStreetMaps
    $.consultaMapa(-22.972075, -47.14946);

    // Flexslider
    $('.flexslider').flexslider({
        animation: "slide",
        slideshow: false,
        itemWidth: 520,
        keyboard: false,
        mousewheel: false,
        animationLoop: false,
        controlNav: false
    });
    /* Fim - Grupo de comandos de carga de plugins */

    /* Inicio - Grupo de comandos para carga dos selects de busca */
    // Lista os tipos de residência
    $.each(tipos_residencia.tipos, function (key, val) {
        $('#tiposResidencia').append('<option value="' + key + '">' + val + '</option>');
    });

    // Lista os estados
    $.each(uf_cidade.estados, function (key, val) {
        $('#estados').append('<option value="' + val.sigla + '">' + val.sigla + '</option>');
    });

    // Lista as cidades com base no estado default
    $.consultaCidade($('#estados :selected').text(), '#cidades');    

    /* Troca de valor do select estados */
    $('#estados').change(function () {
        $.consultaCidade($('#estados :selected').text(), '#cidades');
    });
    /* Fim - Grupo de comandos para carga dos selects de busca */

    /* Ação para busca rápida */
    $('#buscar').click(function () {
        var form = $('#buscaRapida').serializeArray();
        var lat = 0, lng = 0;

        var url = 'http://maps.google.com/maps/api/geocode/json?address=' + form[3].value.replace(/[áàâã]/g, 'a').replace(/[éèê]/g, 'e').replace(/[óòôõ]/g, 'o').replace(/[úùû]/g, 'u') + '+' + form[2].value + '&sensor=false';

        console.log(url);

        $.getJSON(url, function (data) {
            $.each(data.results, function (key, val) {
                lat = val.geometry.location.lat;
                lng = val.geometry.location.lng;
            });

            // OpenStreetMaps
            $.consultaMapa(parseFloat(lat), parseFloat(lng));
        });

        return false;
    });
</script>
